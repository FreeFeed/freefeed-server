import { writeFileSync } from 'fs';

import config from 'config';


const knexFile = 'knexfile.js';
const environments = config.knexEnvironments;

process.stdout.write(`Creating knexfile for environments: ${environments.join(', ')}\n`);

const knexConfig = {};

for (const env of environments) {
  process.env.NODE_ENV = env;
  knexConfig[env] = config.util.loadFileConfigs().postgres;
}

writeFileSync(knexFile, `/* eslint-disable */
// This file was automatically generated by bin/create-knexfile.js

try {
  require('@babel/register');
} catch (e) {
  // it's ok. might be already enabled
}

module.exports = ${JSON.stringify(knexConfig, null, '\t')};
`);
